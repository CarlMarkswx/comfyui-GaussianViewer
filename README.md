# ComfyUI-GaussianViewer

[![License: GPL-3.0-or-later](https://img.shields.io/badge/License-GPL--3.0--or--later-blue.svg)](LICENSE)

ä¸º ComfyUI æä¾›é«˜æ–¯æ³¼æº…ï¼ˆGaussian Splattingï¼‰PLY æ–‡ä»¶çš„äº¤äº’å¼ 3D é¢„è§ˆå’Œé«˜è´¨é‡å›¾åƒè¾“å‡ºåŠŸèƒ½ã€‚

**æ³¨æ„**ï¼šæœ¬æ’ä»¶æ˜¯åŸºäº [ComfyUI-GeometryPack](https://github.com/PozzettiAndrea/ComfyUI-GeometryPack) æ”¹è¿›è€Œæ¥ï¼Œæä¾›äº†æ›´ç®€æ´å’Œæ˜“ç”¨çš„å•ä¸€èŠ‚ç‚¹æ–¹æ¡ˆã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **äº¤äº’å¼ 3D é¢„è§ˆ** - åœ¨ ComfyUI ä¸­å®æ—¶é¢„è§ˆ Gaussian Splatting PLY æ–‡ä»¶
- ğŸ“¸ **é«˜è´¨é‡æ¸²æŸ“** - è¾“å‡º 2048px çŸ­è¾¹çš„é«˜åˆ†è¾¨ç‡å›¾åƒ
- ğŸ¥ **ç›¸æœºå‚æ•°æ§åˆ¶** - æ”¯æŒå¤–å‚ï¼ˆextrinsicsï¼‰å’Œå†…å‚ï¼ˆintrinsicsï¼‰è¾“å…¥
- ğŸ’¾ **ç›¸æœºçŠ¶æ€ç¼“å­˜** - è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤ç›¸æœºè§†è§’å‚æ•°
- ğŸ”— **æ— ç¼é›†æˆ** - è¾“å‡º IMAGE å¯ç›´æ¥è¿æ¥åˆ° ComfyUI å…¶ä»–èŠ‚ç‚¹
- ğŸŒ **Web ç•Œé¢** - åŸºäº gsplat.js çš„ç°ä»£ 3D æŸ¥çœ‹å™¨

## å®‰è£…

### æ–¹æ³• 1: ä» GitHub å®‰è£…

```bash
cd ComfyUI/custom_nodes
git clone https://github.com/CarlMarkswx/comfyui-GaussianViewer.git
```

### æ–¹æ³• 2: æ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æ­¤ä»“åº“çš„ ZIP æ–‡ä»¶
2. è§£å‹åˆ° `ComfyUI/custom_nodes/` ç›®å½•
3. é‡å‘½åæ–‡ä»¶å¤¹ä¸º `comfyui-GaussianViewer`

### ä¾èµ–é¡¹

æ’ä»¶ä¾èµ–äºä»¥ä¸‹ Python åŒ…ï¼ˆé€šå¸¸å·²éš ComfyUI å®‰è£…ï¼‰ï¼š

```
numpy
torch
Pillow
```

å¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼š

```bash
pip install numpy torch Pillow
```

## ä½¿ç”¨æ–¹æ³•

### ä¸»è¦èŠ‚ç‚¹

æ’ä»¶æä¾›ä»¥ä¸‹èŠ‚ç‚¹ï¼š

#### GaussianViewer

è¿™æ˜¯ä¸»èŠ‚ç‚¹ï¼Œé›†æˆäº†é¢„è§ˆå’Œæ¸²æŸ“åŠŸèƒ½ã€‚

**è¾“å…¥å‚æ•°**ï¼š
- `ply_path`ï¼ˆå¿…éœ€ï¼‰ï¼šGaussian Splatting PLY æ–‡ä»¶è·¯å¾„
- `extrinsics`ï¼ˆå¯é€‰ï¼‰ï¼š4x4 ç›¸æœºå¤–å‚çŸ©é˜µï¼Œç”¨äºè®¾ç½®åˆå§‹è§†è§’
- `intrinsics`ï¼ˆå¯é€‰ï¼‰ï¼š3x3 ç›¸æœºå†…å‚çŸ©é˜µï¼Œç”¨äºè®¾ç½®è§†åœºè§’

**è¾“å‡º**ï¼š
- `image`ï¼šæ¸²æŸ“åçš„å›¾åƒï¼ˆIMAGE ç±»å‹ï¼‰

**ä½¿ç”¨æ­¥éª¤**ï¼š
1. åœ¨èŠ‚ç‚¹ä¸­è¿æ¥ PLY æ–‡ä»¶è·¯å¾„
2. åœ¨é¢„è§ˆçª—å£ä¸­è°ƒæ•´ç›¸æœºè§†è§’
3. **é‡è¦**ï¼šç‚¹å‡» "Set Camera" æŒ‰é’®æ¥è®¾ç½®ç›¸æœºä½ç½®ï¼Œè¿™æ ·æ‰èƒ½æ­£å¼å¼€å§‹æ¸²æŸ“
4. èŠ‚ç‚¹ä¼šæ¸²æŸ“å¹¶è¾“å‡ºå½“å‰è§†è§’çš„å›¾åƒ
5. è¾“å‡ºçš„å›¾åƒå¯ç”¨äºåç»­å¤„ç†

### å·¥ä½œæµç¤ºä¾‹

#### åŸºç¡€é¢„è§ˆå’Œæ¸²æŸ“

```
[PLY æ–‡ä»¶è·¯å¾„] â†’ [GaussianViewer] â†’ [å›¾åƒè¾“å‡º]
```

#### ä½¿ç”¨ç›¸æœºå‚æ•°

```
[PLY æ–‡ä»¶è·¯å¾„] + [ç›¸æœºå¤–å‚] + [ç›¸æœºå†…å‚] â†’ [GaussianViewer] â†’ [å›¾åƒè¾“å‡º]
```

#### é›†æˆåˆ°å¤æ‚å·¥ä½œæµ

```
[PLY æ–‡ä»¶è·¯å¾„] â†’ [GaussianViewer] â†’ [å›¾åƒå¤„ç†èŠ‚ç‚¹] â†’ [ä¿å­˜/æ˜¾ç¤º]
```

## æŠ€æœ¯ç»†èŠ‚

### ç›¸æœºå‚æ•°

ç›¸æœºå‚æ•°ç”¨äºæ§åˆ¶ 3D åœºæ™¯çš„è§†è§’å’ŒæŠ•å½±ï¼š

- **å¤–å‚ï¼ˆExtrinsicsï¼‰**ï¼š4x4 çŸ©é˜µï¼Œå®šä¹‰ç›¸æœºåœ¨ä¸–ç•Œåæ ‡ç³»ä¸­çš„ä½ç½®å’Œæ—‹è½¬
- **å†…å‚ï¼ˆIntrinsicsï¼‰**ï¼š3x3 çŸ©é˜µï¼Œå®šä¹‰ç›¸æœºçš„ç„¦è·å’Œä¸»ç‚¹ï¼Œå½±å“è§†åœºè§’

### æ¸²æŸ“åˆ†è¾¨ç‡

- é»˜è®¤è¾“å‡ºåˆ†è¾¨ç‡ï¼šçŸ­è¾¹ 2048 åƒç´ 
- é•¿è¾¹æ ¹æ®æºæ–‡ä»¶çš„æ¯”ä¾‹è‡ªåŠ¨è®¡ç®—
- è¾“å‡ºæ ¼å¼ï¼šRGB å½©è‰²å›¾åƒï¼ˆ0-1 èŒƒå›´çš„æµ®ç‚¹æ•°ï¼‰

### è¾“å‡ºæ–‡ä»¶å

æ¸²æŸ“çš„å›¾åƒä¼šè‡ªåŠ¨ä¿å­˜åˆ° ComfyUI çš„è¾“å‡ºç›®å½•ï¼Œæ–‡ä»¶åæ ¼å¼ï¼š

```
gaussian-{PLYæ–‡ä»¶å}-render-{æ—¶é—´æˆ³}.png
```

### ç›¸æœºçŠ¶æ€ç¼“å­˜

æ’ä»¶ä¼šè‡ªåŠ¨ç¼“å­˜æ¯ä¸ª PLY æ–‡ä»¶çš„ç›¸æœºçŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼š
- ç›¸æœºä½ç½®ï¼ˆpositionï¼‰
- è§‚å¯Ÿç›®æ ‡ï¼ˆtargetï¼‰
- ç„¦è·ï¼ˆfx, fyï¼‰
- å›¾åƒå°ºå¯¸ï¼ˆimage_width, image_heightï¼‰
- ç¼©æ”¾å› å­ï¼ˆscaleï¼‰
- ç¼©æ”¾è¡¥å¿ï¼ˆscale_compensationï¼‰

è¿™äº›çŠ¶æ€ä¼šåœ¨èŠ‚ç‚¹é‡æ–°æ‰§è¡Œæ—¶è‡ªåŠ¨æ¢å¤ã€‚

## æ–‡ä»¶ç»“æ„

```
comfyui-GaussianViewer/
â”œâ”€â”€ __init__.py                 # æ’ä»¶å…¥å£å’ŒèŠ‚ç‚¹æ³¨å†Œ
â”œâ”€â”€ gaussian_viewer.py          # ä¸»èŠ‚ç‚¹ï¼ˆé¢„è§ˆ+æ¸²æŸ“ï¼‰
â”œâ”€â”€ render_gaussian.py          # æ¸²æŸ“èŠ‚ç‚¹å’Œ HTTP ç«¯ç‚¹
â”œâ”€â”€ preview_gaussian2.py        # é¢„è§ˆèŠ‚ç‚¹
â”œâ”€â”€ camera_params.py            # ç›¸æœºå‚æ•°ç¼“å­˜æ¨¡å—
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â””â”€â”€ web/                        # Web ç•Œé¢å’Œ JavaScript æ–‡ä»¶
    â”œâ”€â”€ viewer_gaussian_v2.html # é¢„è§ˆæŸ¥çœ‹å™¨ç•Œé¢
    â”œâ”€â”€ viewer_render_gaussian.html # æ¸²æŸ“æŸ¥çœ‹å™¨ç•Œé¢
    â””â”€â”€ js/                     # JavaScript æ¨¡å—
        â”œâ”€â”€ gsplat-bundle.js    # gsplat.js åº“
        â”œâ”€â”€ gaussian_preview_v2.js
        â””â”€â”€ render_gaussian.js
```

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šPLY æ–‡ä»¶æ— æ³•åŠ è½½

**å¯èƒ½åŸå› **ï¼š
- æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®
- æ–‡ä»¶ä¸åœ¨ ComfyUI çš„è¾“å‡ºç›®å½•ä¸­

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤ PLY æ–‡ä»¶è·¯å¾„æ­£ç¡®
- å°† PLY æ–‡ä»¶æ”¾åœ¨ ComfyUI çš„è¾“å‡ºç›®å½•ä¸­

### é—®é¢˜ 2ï¼šæ¸²æŸ“è¶…æ—¶

**å¯èƒ½åŸå› **ï¼š
- PLY æ–‡ä»¶è¿‡å¤§
- ç³»ç»Ÿèµ„æºä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å‡å° PLY æ–‡ä»¶çš„å¤§å°
- å…³é—­å…¶ä»–å ç”¨èµ„æºçš„ç¨‹åº
- å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆä¿®æ”¹ `render_gaussian.py` ä¸­çš„ timeout å‚æ•°ï¼‰

### é—®é¢˜ 3ï¼šå›¾åƒè¾“å‡ºä¸ºç©ºç™½

**å¯èƒ½åŸå› **ï¼š
- PLY æ–‡ä»¶æŸå
- ç›¸æœºå‚æ•°ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ PLY æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆ
- å°è¯•ä¸æä¾›ç›¸æœºå‚æ•°ï¼Œä½¿ç”¨é»˜è®¤è§†è§’

### é—®é¢˜ 4ï¼šæ’ä»¶èŠ‚ç‚¹æœªæ˜¾ç¤º

**å¯èƒ½åŸå› **ï¼š
- æ’ä»¶æœªæ­£ç¡®å®‰è£…
- ComfyUI æœªé‡å¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤æ’ä»¶å®‰è£…åœ¨ `ComfyUI/custom_nodes/` ç›®å½•
- é‡å¯ ComfyUI
- æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## å¼€å‘

### æ„å»ºå’Œæµ‹è¯•

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/CarlMarkswx/comfyui-GaussianViewer.git
cd comfyui-GaussianViewer

# å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰
pip install -r requirements.txt

# é‡å¯ ComfyUI ä»¥åŠ è½½æ’ä»¶
```

### è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [GPL-3.0-or-later](LICENSE) è®¸å¯è¯ã€‚

## è‡´è°¢

- [gsplat.js](https://github.com/antimatter15/splat) - ç”¨äº 3D æ¸²æŸ“çš„ JavaScript åº“
- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - å¼ºå¤§çš„èŠ‚ç‚¹å¼å›¾åƒç”Ÿæˆç•Œé¢

## è”ç³»æ–¹å¼

- GitHub: [CarlMarkswx/comfyui-GaussianViewer](https://github.com/CarlMarkswx/comfyui-GaussianViewer)
- Issues: [GitHub Issues](https://github.com/CarlMarkswx/comfyui-GaussianViewer/issues)

---

**æ³¨æ„**ï¼šæ­¤æ’ä»¶ä¸º ComfyUI çš„è‡ªå®šä¹‰èŠ‚ç‚¹æ’ä»¶ï¼Œéœ€è¦å®‰è£… [ComfyUI](https://github.com/comfyanonymous/ComfyUI) æ‰èƒ½ä½¿ç”¨ã€‚
